<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.school.coursemailer.mapper.StudentMapper">

    <select id="selectBySub" resultType="map">
        SELECT
            student_id
            ,google_email
            ,name
            ,created_at
            ,picture
            ,email_verified
            ,given_name
            ,sub
            ,grade
            ,mail_seq
        FROM student
        WHERE sub = #{sub}
    </select>

    <insert id="insertStudent">
        INSERT INTO student (
            google_email
            ,name
            ,created_at
            ,picture
            ,email_verified
            ,given_name
            ,sub
        ) VALUES (
             #{email},
             #{name},
             now(),
             #{picture},
             #{email_verified},
             #{given_name},
             #{sub}
                 )
    </insert>

    <update id="updateStudent" parameterType="map">
        UPDATE student
        <set>
            <if test="google_email != null">
                google_email = #{google_email},
            </if>
            <if test="name != null">
                name = #{name},
            </if>
            <if test="picture != null">
                picture = #{picture},
            </if>
            <if test="email_verified != null">
                email_verified = #{email_verified},
            </if>
            <if test="given_name != null">
                given_name = #{given_name},
            </if>
            <if test="grade != null">
                grade = #{grade}::integer,
            </if>
            <if test="mail_seq != null">
                mail_seq = #{mail_seq}::integer,
            </if>
        </set>
        WHERE sub = #{sub}::varchar
    </update>

    <select id="selectUserMap" parameterType="String" resultType="Map">
        SELECT student_id
             ,google_email
             ,name
             ,created_at
             ,picture
             ,email_verified
             ,given_name
             ,sub,grade
             ,mail_seq
        FROM student
        WHERE sub = #{sub}
    </select>

</mapper>
